import numpy as np
import pandas as pd
from tensorflow.keras.datasets import mnist
from sklearn.decomposition import PCA

(x_train , _), (x_test, _) = mnist.load_data()

print(x_train.shape) #(60000, 28, 28)

x_train_test = np.append(x_train, x_test, axis=0)

print(x_train_test.shape) #(70000, 28, 28)

x_train_test = x_train_test.reshape(70000,784)

# pca = PCA()
# pca.fit(x_train_test)
# cumsum = np.cumsum(pca.explained_variance_ratio_)
# print(cumsum)
# d = np.argmax(cumsum >=0.95) + 1
# print(cumsum >= 0.95)
# print(d) #154

pca = PCA(n_components=154)
x2d = pca.fit_transform((x_train_test))
print(x2d.shape) #(70000, 154)

pca_EVR = pca.explained_variance_ratio_ 

print(pca_EVR) 
print(sum(pca_EVR))

# 결과값
# [0.09746116 0.07155445 0.06149531 0.05403385 0.04888934 0.04305227
#  0.03278262 0.02889642 0.02758364 0.0234214  0.02106689 0.02037553
#  0.01707064 0.0169402  0.01583382 0.01486345 0.01319358 0.01279014
#  0.01187272 0.01152937 0.0106604  0.01009794 0.00959151 0.00909635
#  0.00883287 0.00838818 0.00809832 0.00785718 0.00740262 0.00690014
#  0.00656144 0.0064547  0.00600819 0.00585612 0.00566754 0.00543471
#  0.00504717 0.00487079 0.00478955 0.00467594 0.00454369 0.00444918
#  0.00418217 0.00396164 0.00383708 0.00375785 0.00361426 0.00349025
#  0.00338732 0.00319696 0.00316854 0.00310145 0.0029648  0.00287101
#  0.00282514 0.00269423 0.00268392 0.00256509 0.00253168 0.00244648
#  0.00239702 0.00238581 0.00229234 0.00220949 0.0021306  0.00206317
#  0.00202781 0.00195035 0.00191471 0.00188549 0.00186976 0.00180104
#  0.00176787 0.00173358 0.00164849 0.00163237 0.00161408 0.00154304
#  0.0014702  0.00142198 0.00141015 0.00140145 0.00139602 0.00135022
#  0.0013237  0.00131892 0.00129195 0.00125166 0.00122526 0.00120414
#  0.00116354 0.00114307 0.00112543 0.00109852 0.00108336 0.0010716
#  0.00103678 0.00103401 0.0010058  0.00099897 0.00097656 0.00094143
#  0.00093522 0.0009114  0.00090042 0.00088893 0.00086103 0.00085234
#  0.00083901 0.00081689 0.00078467 0.00077642 0.00077469 0.00076398
#  0.00075959 0.00074757 0.00072899 0.00072436 0.00071362 0.00070205
#  0.00068994 0.00068456 0.00067599 0.00066833 0.00065793 0.00063998
#  0.00062894 0.00062576 0.00061505 0.00059902 0.00059226 0.00058462
#  0.00058318 0.00057521 0.00057185 0.00056214 0.00055751 0.00054139
#  0.0005237  0.00051714 0.00051194 0.000495   0.00049166 0.00048646
#  0.00048068 0.00047402 0.00046761 0.00045792 0.00045485 0.0004496
#  0.00044179 0.00043403 0.00042545 0.00041659]
# 0.9499461891903472